<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸš€ Project Scope Portal</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #1e40af;
            --primary-red: #dc2626;
            --gradient-bg: linear-gradient(135deg, #1e40af 0%, #dc2626 100%);
            --card-shadow: 0 10px 25px rgba(0,0,0,0.1);
            --border-radius: 12px;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gradient-bg);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            overflow: hidden;
        }
        
        .header {
            background: var(--gradient-bg);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .nav-tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .nav-tab {
            flex: 1;
            padding: 20px;
            background: none;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #64748b;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .nav-tab:hover {
            background: #e2e8f0;
            color: var(--primary-blue);
        }
        
        .nav-tab.active {
            background: var(--primary-blue);
            color: white;
            box-shadow: inset 0 -3px 0 var(--primary-red);
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 0.95rem;
        }
        
        input, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }
        
        textarea {
            height: 100px;
            resize: vertical;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--primary-blue);
            color: white;
        }
        
        .btn-primary:hover {
            background: #1e3a8a;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        .project-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
        }
        
        .project-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .project-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-bg);
        }
        
        .project-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-shadow);
        }
        
        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .project-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }
        
        .project-id {
            background: var(--primary-red);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .project-info {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .project-info i {
            color: var(--primary-blue);
            width: 16px;
        }
        
        .project-info strong {
            color: #374151;
            min-width: 80px;
        }
        
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }
        
        .alert-success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        
        .alert-error {
            background: #fef2f2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        
        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            text-align: center;
            border-left: 4px solid var(--primary-blue);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-blue);
        }
        
        .stat-label {
            color: #6b7280;
            font-weight: 500;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .project-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tab {
                padding: 15px 10px;
                font-size: 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-rocket"></i> Project Scope Portal</h1>
            <p>Advanced Project Management & Submission System</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </button>
            <button class="nav-tab" onclick="showTab('submit')">
                <i class="fas fa-plus-circle"></i> Submit Project
            </button>
            <button class="nav-tab" onclick="showTab('manage')">
                <i class="fas fa-tasks"></i> View Projects
            </button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalProjects">0</div>
                    <div class="stat-label">Total Projects</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="recentProjects">0</div>
                    <div class="stat-label">Recent Submissions</div>
                </div>
            </div>
            
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                Welcome to Project Scope Portal! Submit projects and view all submissions in real-time.
            </div>
            
            <div id="recentProjectsList"></div>
        </div>

        <!-- Submit Project Tab -->
        <div id="submit" class="tab-content">
            <h2 style="margin-bottom: 25px; color: var(--primary-blue);">
                <i class="fas fa-plus-circle"></i> Submit New Project
            </h2>
            
            <form id="projectForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="project_name">Project Name *</label>
                        <input type="text" id="project_name" required placeholder="Enter project name">
                    </div>
                    
                    <div class="form-group">
                        <label for="roll_number">Roll Number</label>
                        <input type="text" id="roll_number" placeholder="Enter roll number">
                    </div>
                    
                    <div class="form-group">
                        <label for="class_name">Class</label>
                        <input type="text" id="class_name" placeholder="Enter class">
                    </div>
                    
                    <div class="form-group">
                        <label for="year">Year</label>
                        <input type="number" id="year" min="1" max="10" placeholder="Enter year">
                    </div>
                    
                    <div class="form-group">
                        <label for="branch">Branch</label>
                        <input type="text" id="branch" placeholder="Enter branch">
                    </div>
                    
                    <div class="form-group">
                        <label for="sec">Section</label>
                        <input type="text" id="sec" placeholder="Enter section">
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="idea">Project Idea *</label>
                        <textarea id="idea" required placeholder="Describe your project idea..."></textarea>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="team_members">Team Members</label>
                        <input type="text" id="team_members" placeholder="Enter team members (comma separated)">
                    </div>
                    
                    <div class="form-group">
                        <label for="tools">Tools</label>
                        <input type="text" id="tools" placeholder="Enter tools used">
                    </div>
                    
                    <div class="form-group">
                        <label for="technologies">Technologies</label>
                        <input type="text" id="technologies" placeholder="Enter technologies used">
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i> Submit Project
                </button>
                
                <div id="submitMessage"></div>
            </form>
        </div>

        <!-- View Projects Tab -->
        <div id="manage" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="color: var(--primary-blue);">
                    <i class="fas fa-tasks"></i> All Projects
                </h2>
                <button onclick="loadProjects()" class="btn btn-secondary">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            
            <div id="projectsList"></div>
        </div>
    </div>

    <script>
        const API_URL = 'https://projscopebackend.onrender.com/projects/';

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
        });

        function showTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(function(t) { 
                t.classList.remove('active'); 
            });
            document.querySelectorAll('.tab-content').forEach(function(t) { 
                t.classList.remove('active'); 
            });
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'manage') loadProjects();
            if (tabName === 'dashboard') loadDashboard();
        }

        async function loadDashboard() {
            const recentList = document.getElementById('recentProjectsList');
            recentList.innerHTML = '<div class="loading" style="margin: 20px auto;"></div>';
            
            try {
                // First try to wake up the server with a simple request
                console.log('Connecting to server...');
                const response = await fetch(API_URL, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('Response status:', response.status);
                
                if (response.ok) {
                    const projects = await response.json();
                    console.log('Projects loaded:', projects.length);
                    
                    document.getElementById('totalProjects').textContent = projects.length;
                    document.getElementById('recentProjects').textContent = Math.min(projects.length, 5);
                    
                    if (projects.length > 0) {
                        const recent = projects.slice(-3);
                        recentList.innerHTML = '<h3 style="color: var(--primary-blue); margin-bottom: 20px;"><i class="fas fa-clock"></i> Recent Projects</h3><div class="project-grid">' + recent.map(function(proj) { return createProjectCard(proj, true); }).join('') + '</div>';
                    } else {
                        recentList.innerHTML = '<div class="alert alert-info"><i class="fas fa-info-circle"></i>No projects submitted yet. Click "Submit Project" to get started!</div>';
                    }
                } else if (response.status === 500) {
                    // Server is up but has internal error - still allow submissions
                    document.getElementById('totalProjects').textContent = '?';
                    document.getElementById('recentProjects').textContent = '?';
                    recentList.innerHTML = '<div class="alert alert-info"><i class="fas fa-server"></i>Server is starting up. You can still submit projects!</div>';
                } else {
                    recentList.innerHTML = '<div class="alert alert-error"><i class="fas fa-exclamation-triangle"></i>Server error (' + response.status + '). Please try again in a moment.</div>';
                }
            } catch (error) {
                console.error('Connection error:', error);
                document.getElementById('totalProjects').textContent = '?';
                document.getElementById('recentProjects').textContent = '?';
                recentList.innerHTML = '<div class="alert alert-error"><i class="fas fa-wifi"></i>Server is starting up (this may take 30-60 seconds). <button onclick="loadDashboard()" class="btn btn-secondary" style="margin-left: 10px;">Retry</button></div>';
            }
        }

        function createProjectCard(proj, isRecent) {
            return '<div class="project-card"><div class="project-header"><div><div class="project-title">' + proj.project_name + '</div><small style="color: #6b7280;">Roll: ' + (proj.roll_number || 'N/A') + '</small></div><div class="project-id">#' + proj.id + '</div></div><div class="project-info"><i class="fas fa-lightbulb"></i><strong>Idea:</strong> ' + (proj.idea ? (proj.idea.length > 100 ? proj.idea.substring(0, 100) + '...' : proj.idea) : 'N/A') + '</div><div class="project-info"><i class="fas fa-user-friends"></i><strong>Team:</strong> ' + (proj.team_members || 'N/A') + '</div><div class="project-info"><i class="fas fa-graduation-cap"></i><strong>Class:</strong> ' + (proj.class_name || 'N/A') + ' | <strong>Year:</strong> ' + (proj.year || 'N/A') + '</div><div class="project-info"><i class="fas fa-code-branch"></i><strong>Branch:</strong> ' + (proj.branch || 'N/A') + ' | <strong>Section:</strong> ' + (proj.sec || 'N/A') + '</div><div class="project-info"><i class="fas fa-tools"></i><strong>Tools:</strong> ' + (proj.tools || 'N/A') + '</div><div class="project-info"><i class="fas fa-cogs"></i><strong>Tech:</strong> ' + (proj.technologies || 'N/A') + '</div></div>';
        }

        // Submit new project
        document.getElementById('projectForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<div class="loading"></div> Submitting...';
            submitBtn.disabled = true;
            
            const data = {
                project_name: document.getElementById('project_name').value,
                idea: document.getElementById('idea').value,
                team_members: document.getElementById('team_members').value,
                roll_number: document.getElementById('roll_number').value,
                class_name: document.getElementById('class_name').value,
                year: parseInt(document.getElementById('year').value) || null,
                branch: document.getElementById('branch').value,
                sec: document.getElementById('sec').value,
                tools: document.getElementById('tools').value,
                technologies: document.getElementById('technologies').value
            };

            try {
                console.log('Submitting project:', data.project_name);
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                console.log('Submit response status:', response.status);
                const messageDiv = document.getElementById('submitMessage');
                
                if (response.ok) {
                    messageDiv.innerHTML = '<div class="alert alert-success"><i class="fas fa-check-circle"></i>Project submitted successfully! View it in the dashboard.</div>';
                    document.getElementById('projectForm').reset();
                    setTimeout(function() { loadDashboard(); }, 1000);
                } else {
                    try {
                        const error = await response.json();
                        messageDiv.innerHTML = '<div class="alert alert-error"><i class="fas fa-exclamation-circle"></i>Error: ' + (error.detail || 'Failed to submit project') + '</div>';
                    } catch (e) {
                        messageDiv.innerHTML = '<div class="alert alert-error"><i class="fas fa-exclamation-circle"></i>Server error (' + response.status + '). Please try again.</div>';
                    }
                }
            } catch (error) {
                console.error('Submit error:', error);
                document.getElementById('submitMessage').innerHTML = '<div class="alert alert-error"><i class="fas fa-wifi"></i>Connection failed. Server may be starting up - please wait 30 seconds and try again.</div>';
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        // Load all projects
        async function loadProjects() {
            const projectsList = document.getElementById('projectsList');
            projectsList.innerHTML = '<div class="loading" style="margin: 20px auto;"></div>';
            
            try {
                const response = await fetch(API_URL);
                
                if (response.ok) {
                    const projects = await response.json();
                    
                    if (projects.length === 0) {
                        projectsList.innerHTML = '<div class="alert alert-info"><i class="fas fa-info-circle"></i>No projects found. Submit your first project!</div>';
                        return;
                    }

                    projectsList.innerHTML = '<div class="project-grid">' + projects.map(function(proj) { return createProjectCard(proj); }).join('') + '</div>';
                } else {
                    projectsList.innerHTML = '<div class="alert alert-error"><i class="fas fa-exclamation-triangle"></i>Server error. Please try again later.</div>';
                }
            } catch (error) {
                projectsList.innerHTML = '<div class="alert alert-error"><i class="fas fa-wifi"></i>Cannot connect to server. Please check your connection.</div>';
            }
        }
    </script>
</body>
</html>